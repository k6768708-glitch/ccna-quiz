<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CCNA 10é¡ŒæŒ‘æˆ°è³½ (éš¨æ©Ÿç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .option-btn { color: #1f2937 !important; background-color: #ffffff; }
        .correct-text { color: #065f46 !important; font-weight: bold; }
        .wrong-text { color: #991b1b !important; font-weight: bold; }
    </style>
</head>
<body class="bg-slate-100 min-h-screen p-4 flex flex-col items-center">

<div class="max-w-3xl w-full bg-white rounded-2xl shadow-xl overflow-hidden mt-6 mb-10">
    <div class="bg-indigo-600 p-5 text-white flex justify-between items-center">
        <div>
            <h1 class="text-lg font-bold">CCNA 10é¡ŒæŒ‘æˆ°</h1>
            <p id="q-count" class="text-xs opacity-80 uppercase tracking-widest">è¼‰å…¥ä¸­...</p>
        </div>
        <div class="text-right">
            <span id="timer" class="font-mono text-2xl font-bold bg-indigo-700 px-3 py-1 rounded-lg">10:00</span>
        </div>
    </div>
    
    <div class="h-2 bg-gray-200 w-full">
        <div id="progress-bar" class="h-full bg-indigo-400 transition-all duration-500" style="width: 0%"></div>
    </div>

    <div class="p-6 md:p-10">
        <div id="question" class="text-xl md:text-2xl font-bold text-gray-800 mb-8 leading-relaxed">æ­£åœ¨æº–å‚™éš¨æ©Ÿé¡Œåº«...</div>
        
        <div id="img-container" class="mb-6 hidden">
            <img id="q-img" src="" class="rounded-lg border shadow-sm mx-auto max-h-64 bg-white">
        </div>

        <div id="options-grid" class="grid gap-4 mb-8"></div>

        <div id="exp-box" class="hidden p-5 bg-blue-50 border-l-4 border-indigo-500 rounded-r-lg mb-8">
            <p id="exp-text" class="text-indigo-800"></p>
        </div>

        <div class="flex items-center justify-between pt-6 border-t border-gray-100">
            <div class="text-gray-500 font-bold">å¾—åˆ†: <span id="score-display" class="text-indigo-600">0</span></div>
            <button id="next-btn" onclick="nextQuestion()" disabled class="bg-indigo-600 text-white px-10 py-3 rounded-xl font-bold hover:bg-indigo-700 disabled:opacity-30 shadow-lg transition-all">
                ä¸‹ä¸€é¡Œ
            </button>
        </div>
    </div>
</div>

<script>
    let allData = [];
    let quizData = []; // å­˜æ”¾æŠ½é¸å‡ºçš„ 10 é¡Œ
    let currentIdx = 0;
    let score = 0;
    let timerInterval;
    const QUIZ_LIMIT = 10; // é™åˆ¶æ¯æ¬¡ 10 é¡Œ
    const API_URL = 'https://script.google.com/macros/s/AKfycbwY_pt_6EVczd3F8ZwcoGzJCCwooFuFFWU_1pEP9GotcTbGGCqG4FkQOVnD69kbpx3C/exec'; // <--- æ›¿æ›é€™è£¡

    async function fetchQuiz() {
        try {
            const res = await fetch(API_URL);
            allData = await res.json();
            
            // 1. éš¨æ©Ÿæ‰“äº‚æ‰€æœ‰é¡Œç›®
            allData.sort(() => Math.random() - 0.5);
            
            // 2. æŠ½å–å‰ 10 é¡Œ
            quizData = allData.slice(0, QUIZ_LIMIT);
            
            startTimer(10 * 60); // 10 åˆ†é˜
            showQuestion();
        } catch (e) { 
            document.getElementById('question').innerText = "è¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ– APIã€‚"; 
        }
    }

    function startTimer(seconds) {
        let timeLeft = seconds;
        timerInterval = setInterval(() => {
            timeLeft--;
            const m = Math.floor(timeLeft/60).toString().padStart(2,'0');
            const s = (timeLeft%60).toString().padStart(2,'0');
            document.getElementById('timer').innerText = `${m}:${s}`;
            if(timeLeft <= 0) { clearInterval(timerInterval); finishQuiz("æ™‚é–“åˆ°ï¼"); }
        }, 1000);
    }

    function showQuestion() {
        const item = quizData[currentIdx];
        document.getElementById('q-count').innerText = `é¡Œè™Ÿ: ${currentIdx + 1} / ${QUIZ_LIMIT}`;
        document.getElementById('question').innerText = item.q;
        
        const imgCont = document.getElementById('img-container');
        if(item.img && item.img.trim() !== "") {
            document.getElementById('q-img').src = item.img;
            imgCont.classList.remove('hidden');
        } else { imgCont.classList.add('hidden'); }

        const grid = document.getElementById('options-grid');
        grid.innerHTML = '';
        document.getElementById('exp-box').classList.add('hidden');
        document.getElementById('next-btn').disabled = true;
        document.getElementById('progress-bar').style.width = `${((currentIdx + 1)/QUIZ_LIMIT)*100}%`;

        item.options.forEach((opt, i) => {
            const btn = document.createElement('button');
            btn.className = "option-btn p-4 text-left border-2 border-gray-200 rounded-xl hover:border-indigo-400 transition-all text-gray-800 font-medium";
            btn.innerText = opt;
            
            btn.onclick = () => {
                const btns = grid.querySelectorAll('button');
                btns.forEach(b => b.disabled = true);
                if(i === item.correct) {
                    btn.classList.add('bg-green-100', 'border-green-500', 'correct-text');
                    score++;
                    document.getElementById('score-display').innerText = score;
                } else {
                    btn.classList.add('bg-red-100', 'border-red-500', 'wrong-text');
                    btns[item.correct].classList.add('bg-green-100', 'border-green-500', 'correct-text');
                }
                document.getElementById('exp-text').innerText = "ğŸ’¡ è§£æï¼š" + item.exp;
                document.getElementById('exp-box').classList.remove('hidden');
                document.getElementById('next-btn').disabled = false;
            };
            grid.appendChild(btn);
        });
    }

    function nextQuestion() {
        currentIdx++;
        if(currentIdx < QUIZ_LIMIT) {
            showQuestion();
        } else {
            clearInterval(timerInterval);
            finishQuiz("æŒ‘æˆ°å®Œæˆï¼");
        }
    }

    function finishQuiz(msg) {
        const finalScore = Math.round((score / QUIZ_LIMIT) * 100);
        let rank = finalScore >= 80 ? "å„ªç§€ï¼å…·å‚™è€ƒå–è­‰ç…§å¯¦åŠ›" : (finalScore >= 60 ? "åŠæ ¼ï¼Œå†åŠ æŠŠå‹" : "éœ€è¦å¤šè¤‡ç¿’å–”ï¼");
        alert(`${msg}\nå¾—åˆ†ï¼š${score} / ${QUIZ_LIMIT}\næ­£ç¢ºç‡ï¼š${finalScore}%\nè©•åƒ¹ï¼š${rank}`);
        location.reload(); 
    }

    fetchQuiz();
</script>
</body>
</html>
